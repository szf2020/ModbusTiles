{% load static %}
<head>
    <link rel="stylesheet" href="{% static 'global.css' %}">
    <link rel="stylesheet" href="{% static 'widgets.css' %}">
    <link rel="stylesheet" href="{% static 'dashboard.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/gridstack@12.3.3/dist/gridstack.min.css" rel="stylesheet">
</head>
<body>
    <header class="app-header">
        <div class="brand">
            <h1>
                <a href="{% url 'dashboards' %}" class="breadcrumb-link">Dashboards</a>
                <span class="separator">/</span>
                <span id="dashboard-title" class="dashboard-title" title="{{ dashboard.description }}">{{ dashboard.title }}</span>
            </h1>
        </div>
        <div class="header-controls">
            <div class="connection-status hidden" id="connection-banner">⚠️ Offline</div>
            <button type="button" id="edit-button" class="form-button">Edit Dashboard</button>
            <button type="button" id="view-button" class="form-button hidden">View Dashboard</button>
        </div>
    </header>

    <main class="app-layout">
        <div id="loading-spinner" class="spinner">Loading Dashboard...</div>

        <section id="canvas-wrapper" class="canvas-wrapper">
            <div id="dashboard-container" class="dashboard-container" data-alias="{{ dashboard.alias }}">
                <div id="dashboard-grid" class="grid-stack"></div>
            </div>
        </section>

        <aside id="editor-sidebar" class="sidebar">
            <div class="sidebar-header">
                <h2>Editor</h2>
                </div>
            
            <div class="tab-buttons">
                <button id="add-button" class="active" data-tab="palette">Widgets</button>
                <button id="inspect-button" data-tab="tab-inspect">Properties</button>
                <button id="tag-button" data-tab="tab-tag">Tags</button>
                <button id="alarm-button" data-tab="tab-alarm">Alarms</button>
            </div>

            <div class="sidebar-content">
                <div id="palette" class="tab-content active">
                    <p class="section-label">Drag to Add</p>
                    <div class="widget-grid">
                        {% for type in widget_types %}
                            {% include "widgets/"|add:type.value|add:".html" %}
                        {% endfor %}
                    </div>
                </div>
                <div id="tab-inspect" class="tab-content">
                    <div id="inspector-form"></div> 
                </div>
                <div id="tab-tag" class="tab-content">
                    <div id="tag-form"></div> 
                </div>
                <div id="tab-alarm" class="tab-content">
                    <div id="alarm-form"></div> 
                </div>
            </div>
        </aside>
    </main>
</body>
<input id="importFile" class="hidden" type="file" accept=".json"></input>
<script src="https://cdn.plot.ly/plotly-3.3.0.min.js" charset="utf-8"></script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script type="module" src="{% static 'dashboard.js' %}"></script>